IllegalStateException at com.google.javascript.rhino.jstype.FunctionType.getInstanceType
> What steps will reproduce the problem?  1. Unpack attached test case.  2. Ensure make, wget, unzip, and java are on your PATH  3. make prep (or just set up the build manually, it's not complicated)  4. make crash    > What is the expected output? What do you see instead?  Expected output: either successful compilation, or a compilation error.  Actual output:   $ java \     -jar ./compiler.jar \     --js crash.js \     --warning_level=VERBOSE \     --compilation_level=SIMPLE_OPTIMIZATIONS  java.lang.RuntimeException: java.lang.IllegalStateException   at com.google.javascript.jscomp.Compiler.runInCompilerThread(Compiler.java:715)   at com.google.javascript.jscomp.Compiler.compile(Compiler.java:647)   at com.google.javascript.jscomp.Compiler.compile(Compiler.java:603)   at com.google.javascript.jscomp.AbstractCommandLineRunner.doRun(AbstractCommandLineRunner.java:783)   at com.google.javascript.jscomp.AbstractCommandLineRunner.run(AbstractCommandLineRunner.java:379)   at com.google.javascript.jscomp.CommandLineRunner.main(CommandLineRunner.java:972)  Caused by: java.lang.IllegalStateException   at com.google.common.base.Preconditions.checkState(Preconditions.java:133)   at com.google.javascript.rhino.jstype.FunctionType.getInstanceType(FunctionType.java:1071)   at com.google.javascript.jscomp.TypeCheck.visitNew(TypeCheck.java:1567)   at com.google.javascript.jscomp.TypeCheck.visit(TypeCheck.java:569)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:534)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseFunction(NodeTraversal.java:569)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:522)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:528)   at com.google.javascript.jscomp.NodeTraversal.traverseWithScope(NodeTraversal.java:353)   at com.google.javascript.jscomp.TypeCheck.check(TypeCheck.java:400)   at com.google.javascript.jscomp.TypeCheck.process(TypeCheck.java:371)   at com.google.javascript.jscomp.DefaultPassConfig$30$1.process(DefaultPassConfig.java:1237)   at com.google.javascript.jscomp.PhaseOptimizer$NamedPass.process(PhaseOptimizer.java:293)   at com.google.javascript.jscomp.PhaseOptimizer.process(PhaseOptimizer.java:237)   at com.google.javascript.jscomp.Compiler.check(Compiler.java:830)   at com.google.javascript.jscomp.Compiler.compileInternal(Compiler.java:742)   at com.google.javascript.jscomp.Compiler.access$000(Compiler.java:83)   at com.google.javascript.jscomp.Compiler$2.call(Compiler.java:650)   at com.google.javascript.jscomp.Compiler$2.call(Compiler.java:647)   at com.google.javascript.jscomp.Compiler$3.call(Compiler.java:677)   at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)   at java.util.concurrent.FutureTask.run(FutureTask.java:138)   at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)   at java.lang.Thread.run(Thread.java:680)  make: *** [crash] Error 254    > What version of the product are you using? On what operating system?  closure-compiler release 20130411.  I have also encountered this error on earlier versions of closure-compiler, but the above repro recipe uses 20130411.  I'm currently testing on OS X but this probably happens on other platforms too.    > Please provide any additional information below.    Here's the contents of crash.js (included in the attached archive):    -----begin snip-----  var test = {};    /**   * @interface   */  test.T = function() {};    /**   * @constructor   * @implements {test.T}   */  test.A = function() {};    /**   * @constructor   * @implements {test.T}   */  test.B = function() {};    /**   * @constructor   */  test.X = function() {      this.type = test.A;      this.t = this.f();  };    /**   * @return {test.T}   */  test.X.prototype.f = function() {      if (this.type === test.A) {          return new test.A();      } else if (this.type === test.B) {          return new test.B();      }  };  -----end snip-----  